<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YUCHILL æ¸¬è©¦ç‰ˆ</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: 'Noto Sans TC', sans-serif; background: #f1f5f9; color: #0f172a; }
.tab-active { background: #4f46e5 !important; color: white !important; }
.void-line { text-decoration: line-through; opacity: 0.15; filter: grayscale(1); pointer-events: none; }
input, select, button { font-weight: 800; }
</style>
</head>
<body class="pb-10">

<nav class="bg-white border-b sticky top-0 z-50 shadow-sm p-4 flex justify-between items-center">
    <h1 class="font-black text-2xl italic">YUCHILL <span class="text-indigo-600">v71</span></h1>
    <div class="flex gap-2">
        <button id="tab-main" class="tab-active px-4 py-2 rounded-xl" onclick="switchTab('main')">æ¥­å‹™è™•ç†</button>
        <button id="tab-report" class="px-4 py-2 rounded-xl text-slate-500" onclick="switchTab('report')">åˆ©æ½¤å ±è¡¨</button>
        <button onclick="exportData()" class="px-4 py-2 rounded-xl bg-slate-200">å‚™ä»½è³‡æ–™</button>
    </div>
</nav>

<div class="max-w-3xl mx-auto p-4">
    <div id="page-main">
        <form id="main-form" class="bg-white p-6 rounded-xl shadow-md space-y-4">
            <div class="flex gap-2">
                <button type="button" id="m-sell" class="flex-1 bg-white text-indigo-600 shadow-sm rounded-xl py-2" onclick="setMode('sell')">éŠ·å”®</button>
                <button type="button" id="m-buy" class="flex-1 bg-slate-200 rounded-xl py-2" onclick="setMode('buy')">é€²è²¨</button>
            </div>
            <div class="flex gap-2">
                <input type="date" id="f-date" class="flex-1 p-2 rounded-xl border" onchange="autoRefreshBarcode()">
                <input type="number" id="f-qty" value="1" min="1" class="w-24 p-2 rounded-xl border">
            </div>
            <div class="flex gap-2">
                <input type="text" id="f-barcode" placeholder="æ¢ç¢¼" class="flex-1 p-2 rounded-xl border text-center" oninput="handleBarcodeInput(this.value)">
                <button type="button" onclick="generateNextBarcode()" class="px-4 py-2 bg-white rounded-xl border">ğŸ”„</button>
            </div>
            <input type="text" id="f-car-type" placeholder="è»Šå‹" class="w-full p-2 rounded-xl border">
            <input type="text" id="f-color" placeholder="é¡è‰²" class="w-full p-2 rounded-xl border">
            <input type="text" id="f-vin" placeholder="è»Šæ¶è™Ÿ" class="w-full p-2 rounded-xl border">
            <input type="text" id="f-motor" placeholder="é›»æ©Ÿè™Ÿ" class="w-full p-2 rounded-xl border">
            <input type="text" id="f-cust" placeholder="å‚™è¨»" class="w-full p-2 rounded-xl border">
            <div class="flex gap-2">
                <input type="number" id="f-cash" placeholder="ç¾é‡‘æ”¶" class="flex-1 p-2 rounded-xl border">
                <input type="number" id="f-bank" placeholder="è½‰å¸³æ”¶" class="flex-1 p-2 rounded-xl border">
            </div>
            <div class="flex gap-2">
                <button type="button" onclick="resetForm()" class="flex-1 bg-slate-200 rounded-xl py-2">é‡ç½®</button>
                <button type="button" onclick="doSave()" class="flex-1 bg-indigo-600 text-white rounded-xl py-2">ç¢ºèªå„²å­˜</button>
            </div>
        </form>

        <div id="stk-grid" class="grid grid-cols-3 gap-2 mt-4"></div>
        <table class="w-full text-left mt-4 border">
            <thead><tr><th>æ‘˜è¦</th><th>å…§å®¹</th><th>é‡‘é¡</th><th>åˆª</th></tr></thead>
            <tbody id="log-list"></tbody>
        </table>
    </div>

    <div id="page-report" class="hidden">
        <h2 class="font-black text-xl mb-2">å ±è¡¨å€</h2>
        <div id="profit-table-area"></div>
        <div class="mt-4">
            <input type="number" id="f-withdraw" placeholder="è¼¸å…¥æé ˜é‡‘é¡" class="p-2 border rounded-xl">
            <button onclick="addWithdraw()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl">ç¢ºèªæé ˜</button>
        </div>
        <div id="withdraw-list" class="mt-2"></div>
    </div>
</div>

<script>
const KEY="YUCHILL_TEST";
let db = JSON.parse(localStorage.getItem(KEY))||{stock:{},logs:[],withdraws:[]};
let currentMode='sell';

function setMode(m){currentMode=m;document.getElementById('m-sell').className=(m==='sell'?'bg-white text-indigo-600 shadow-sm ':'bg-slate-200 ')+'flex-1 py-2';document.getElementById('m-buy').className=(m==='buy'?'bg-white text-indigo-600 shadow-sm ':'bg-slate-200 ')+'flex-1 py-2';resetForm();}
function resetForm(){document.getElementById('main-form').reset();}
function switchTab(t){document.getElementById('page-main').style.display=t==='main'?'block':'none';document.getElementById('page-report').style.display=t==='report'?'block':'none';}
function generateNextBarcode(){document.getElementById('f-barcode').value='BAR'+Math.floor(Math.random()*9999);return document.getElementById('f-barcode').value;}
function handleBarcodeInput(val){console.log('è¼¸å…¥æ¢ç¢¼:',val);}
function autoRefreshBarcode(){if(currentMode==='buy') generateNextBarcode();}
function doSave(){alert('å„²å­˜æˆåŠŸ'); render();}
function render(){document.getElementById('stk-grid').innerHTML=Object.keys(db.stock).map(k=>`<div>${k}</div>`).join('');document.getElementById('log-list').innerHTML=db.logs.map((l,i)=>`<tr><td>${l.barcode}</td><td>${l.carName}</td><td>${l.cash}</td><td><button onclick="askUndo(${i})">Ã—</button></td></tr>`).join('');}
function askUndo(i){db.logs[i].void=true;render();}
function addWithdraw(){const amt=parseInt(document.getElementById('f-withdraw').value)||0;if(!amt){alert('è«‹è¼¸å…¥é‡‘é¡');return;}db.withdraws.unshift({date:new Date().toLocaleDateString(),amount:amt});render();}
function exportData(){alert(JSON.stringify(db,null,2));}
render();
</script>

</body>
</html>
