<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YUCHILL v77 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        .tab-active { background: #4f46e5 !important; color: white !important; }
        .profit-card { border-left: 10px solid #10b981; }
        input { font-weight: 800; }
    </style>
</head>
<body class="pb-20">

    <nav class="bg-white border-b sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="font-black text-2xl italic">YUCHILL <span class="text-indigo-600 text-sm">v77</span></h1>
            <div class="flex bg-slate-200 rounded-2xl p-1">
                <button onclick="switchTab('main')" id="tab-main" class="tab-active px-6 py-2 rounded-xl font-black transition-all">æ¥­å‹™è¼¸å…¥</button>
                <button onclick="switchTab('report')" id="tab-report" class="px-6 py-2 rounded-xl font-black text-slate-500 transition-all">åˆ©æ½¤å ±è¡¨</button>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <div id="page-main">
            <div class="bg-white p-6 rounded-[2.5rem] shadow-xl space-y-5">
                <div class="flex bg-slate-100 rounded-2xl p-1 font-black">
                    <button type="button" onclick="setMode('sell')" id="m-sell" class="flex-1 py-4 rounded-xl bg-white shadow-sm text-indigo-600">éŠ·å”®/å‡ºè²¨</button>
                    <button type="button" onclick="setMode('buy')" id="m-buy" class="flex-1 py-4 rounded-xl text-slate-400">é€²è²¨/æ”¯å‡º</button>
                    <button type="button" onclick="setMode('withdraw')" id="m-withdraw" class="flex-1 py-4 rounded-xl text-slate-400">ã€Œå·²æã€ç™»è¨˜</button>
                </div>

                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="date" id="f-date" class="p-4 rounded-2xl bg-slate-50 border h-14">
                        <input type="text" id="f-barcode" placeholder="ç·¨è™Ÿ/æ¢ç¢¼" class="p-4 rounded-2xl bg-slate-50 border h-14 text-center">
                    </div>

                    <div id="trade-fields" class="space-y-4">
                        <div class="grid grid-cols-2 gap-2">
                            <select id="f-car" class="p-4 rounded-xl bg-white border h-14 font-black">
                                <option value="ä¸€èˆ¬å•†å“">ä¸€èˆ¬å•†å“</option><option>Jå¯„è³£æ¬¾</option><option>Gé’æ˜¥ç‰ˆ</option><option>Qç‰¹æƒ ç‰ˆ</option><option>Wé«˜é…ç‰ˆ</option><option>ç¶­ä¿®æœå‹™</option>
                            </select>
                            <input type="number" id="f-extra" placeholder="éŠ·å”®é¡å¤–æˆæœ¬" class="p-4 rounded-xl bg-red-50 text-red-600 border h-14">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" id="f-cash" placeholder="ğŸ’° ç¾é‡‘/é‡‘é¡" class="p-5 rounded-2xl bg-amber-50 font-black text-amber-800 border h-16">
                        <input type="number" id="f-bank" placeholder="ğŸ¦ è½‰å¸³" class="p-5 rounded-2xl bg-blue-50 font-black text-blue-800 border h-16">
                    </div>
                    
                    <input type="text" id="f-cust" placeholder="å‚™è¨»è¨Šæ¯ (å¦‚ï¼šå·²æé ˜çµ¦äºˆæŸæŸ)" class="w-full p-4 rounded-2xl bg-white border h-14">
                </div>

                <button type="button" onclick="doSave()" class="w-full py-6 rounded-3xl font-black text-2xl bg-slate-900 text-white shadow-xl active:scale-95 transition-transform">å„²å­˜ç´€éŒ„</button>
            </div>
            
            <div id="log-container" class="mt-8 space-y-3"></div>
        </div>

        <div id="page-report" class="hidden space-y-6">
            <div class="bg-indigo-900 p-8 rounded-[2.5rem] text-white shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-indigo-200 font-bold">å‰©é¤˜å¯æåˆ©æ½¤ (çµé¤˜)</span>
                    <span class="bg-indigo-700 px-3 py-1 rounded-full text-xs">é–€æª» 100,000</span>
                </div>
                <div id="r-rem-profit" class="text-5xl font-black mb-2">$0</div>
                <div class="h-2 bg-indigo-800 rounded-full overflow-hidden">
                    <div id="r-progress" class="h-full bg-green-400 w-0"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-emerald-500">
                    <div class="text-xs text-slate-400 font-bold">éŠ·å”®åˆ©æ½¤ (æ¯›åˆ©)</div>
                    <div id="r-sales-profit" class="text-xl font-black text-slate-800">$0</div>
                </div>
                <div id="withdraw-card" class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-orange-500">
                    <div class="text-xs text-slate-400 font-bold">ç´¯ç©å·²æé ˜</div>
                    <div id="r-withdrawn" class="text-xl font-black text-orange-600">$0</div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-[2rem] shadow-sm">
                <h3 class="font-black mb-4">å¸³å‹™æ‹†è§£</h3>
                <div class="space-y-3 text-sm" id="r-detail"></div>
            </div>
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('yuchill_v77_data') || '[]');
        let currentMode = 'sell';
        const THRESHOLD = 100000; // é…é¡é ç®— + åº«å­˜æˆæœ¬

        document.getElementById('f-date').valueAsDate = new Date();

        function switchTab(tab) {
            document.getElementById('page-main').classList.toggle('hidden', tab !== 'main');
            document.getElementById('page-report').classList.toggle('hidden', tab !== 'report');
            if(tab === 'report') renderReport();
        }

        function setMode(mode) {
            currentMode = mode;
            const btns = ['m-sell', 'm-buy', 'm-withdraw'];
            btns.forEach(id => {
                document.getElementById(id).className = id === 'm-' + mode ? 'flex-1 py-4 rounded-xl bg-white shadow-sm text-indigo-600' : 'flex-1 py-4 rounded-xl text-slate-400';
            });
            document.getElementById('trade-fields').classList.toggle('hidden', mode === 'withdraw');
        }

        function doSave() {
            const data = {
                date: document.getElementById('f-date').value,
                mode: currentMode,
                barcode: document.getElementById('f-barcode').value || 'N/A',
                car: document.getElementById('f-car').value,
                extra: Number(document.getElementById('f-extra').value) || 0,
                cash: Number(document.getElementById('f-cash').value) || 0,
                bank: Number(document.getElementById('f-bank').value) || 0,
                cust: document.getElementById('f-cust').value,
                ts: Date.now()
            };
            records.push(data);
            localStorage.setItem('yuchill_v77_data', JSON.stringify(records));
            alert('ç´€éŒ„æˆåŠŸï¼');
            resetForm();
            renderLogs();
        }

        function resetForm() {
            ['f-extra', 'f-cash', 'f-bank', 'f-cust'].forEach(id => document.getElementById(id).value = '');
        }

        function renderLogs() {
            const container = document.getElementById('log-container');
            container.innerHTML = records.slice(-10).reverse().map((r, i) => `
                <div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border-l-4 ${r.mode==='sell'?'border-green-500': r.mode==='buy'?'border-red-500':'border-orange-500'}">
                    <div>
                        <div class="font-black text-sm">${r.date} | ${r.mode==='sell'?'éŠ·å”®':r.mode==='buy'?'é€²è²¨':'å·²æ'}</div>
                        <div class="text-xs text-slate-500">${r.car} ${r.cust ? '('+r.cust+')' : ''}</div>
                    </div>
                    <div class="text-right font-black">$${(r.cash + r.bank).toLocaleString()}</div>
                </div>
            `).join('');
        }

        function renderReport() {
            const sellIn = records.filter(r => r.mode === 'sell').reduce((a, b) => a + (b.cash + b.bank), 0);
            const extraCost = records.filter(r => r.mode === 'sell').reduce((a, b) => a + b.extra, 0);
            const buyOut = records.filter(r => r.mode === 'buy').reduce((a, b) => a + (b.cash + b.bank), 0);
            const withdrawn = records.filter(r => r.mode === 'withdraw').reduce((a, b) => a + (b.cash + b.bank), 0);

            // 1. éŠ·å”®åˆ©æ½¤ = éŠ·å”®é‡‘é¡ - é€²è²¨æˆæœ¬ - éŠ·å”®éç¨‹ç”¢ç”Ÿçš„é¡å¤–æˆæœ¬
            const salesProfit = sellIn - buyOut - extraCost;
            
            // 2. å¯æåˆ©æ½¤ = éŠ·å”®åˆ©æ½¤ - 100,000 (é…é¡é ç®—+åº«å­˜æˆæœ¬)
            const earnable = salesProfit - THRESHOLD;
            
            // 3. å‰©é¤˜åˆ©æ½¤ = å¯æåˆ©æ½¤ - å·²æ
            const remaining = earnable - withdrawn;

            document.getElementById('r-rem-profit').innerText = `$${remaining.toLocaleString()}`;
            document.getElementById('r-sales-profit').innerText = `$${salesProfit.toLocaleString()}`;
            document.getElementById('r-withdrawn').innerText = `$${withdrawn.toLocaleString()}`;
            
            const progress = Math.min(100, Math.max(0, (salesProfit / THRESHOLD) * 100));
            document.getElementById('r-progress').style.width = progress + '%';

            document.getElementById('r-detail').innerHTML = `
                <div class="flex justify-between"><span>éŠ·å”®ç¸½æ”¶ï¼š</span><span class="text-green-600 font-bold">$${sellIn.toLocaleString()}</span></div>
                <div class="flex justify-between"><span>é€²è²¨ç¸½æ”¯ï¼š</span><span class="text-red-500">-$${buyOut.toLocaleString()}</span></div>
                <div class="flex justify-between"><span>éŠ·å”®é¡å¤–æˆæœ¬ï¼š</span><span class="text-red-500">-$${extraCost.toLocaleString()}</span></div>
                <div class="border-t pt-2 mt-2 font-black flex justify-between"><span>éŠ·å”®åˆ©æ½¤ï¼š</span><span>$${salesProfit.toLocaleString()}</span></div>
                <div class="flex justify-between text-indigo-600"><span>æ¸›ï¼šå›ºå®šé–€æª»(10è¬)ï¼š</span><span>-$${THRESHOLD.toLocaleString()}</span></div>
                <div class="border-t pt-2 mt-2 font-black flex justify-between text-lg"><span>å¯æåˆ©æ½¤ç¸½é¡ï¼š</span><span>$${earnable.toLocaleString()}</span></div>
                <div class="flex justify-between text-orange-600"><span>æ¸›ï¼šç´¯è¨ˆå·²æé ˜ï¼š</span><span>-$${withdrawn.toLocaleString()}</span></div>
            `;
        }

        renderLogs();
    </script>
</body>
</html>
